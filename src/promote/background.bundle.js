!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=34)}({34:function(e,t,n){"use strict";n.r(t);n(35),n(36),n(37),n(38);async function a(e){if("anima"===window.extensionName&&!r&&window.userData){const e=window.userData&&window.userData.email?window.userData.email:"";e?chrome.runtime.setUninstallURL(`${window.API_PROJECT}/chrome-extension-uninstall?email=${e}`):chrome.runtime.setUninstallURL(window.API_PROJECT+"/chrome-extension-uninstall")}}window.userLogin=!1,window.mainButton="code",window.extensionName=null,window.userData,window.access_token,chrome.runtime.onMessage.addListener((e,t,n)=>("sendApi"==e.api?async function(e,t,n="GET",a,r=!1,o){let s=t&&"projects"===t.baseUrl?window.API_PROJECT:window.API_URL;a&&"localhost"===a.baseUrl&&(s="http://localhost:5007");const i=r?e:`${s}${e}`;t&&t.baseUrl&&delete t.baseUrl;const c={method:n,headers:a,body:t?JSON.stringify(t):null};let l=await fetch(i,c);if(200==l.status){if(a&&a.toText){return await l.text()}return await l.json()}return{error:await l.json()}}(e.url,e.data,e.method,e.header,e.overwriteUrl).then(e=>{n(e)}):"logout"===e.api?(window.userData=null,window.access_token=null,chrome.tabs.getAllInWindow(e=>{e.map(e=>{chrome.tabs.sendMessage(e.id,{message:"logout"},null,()=>{})})})):"loadFeatureFlag"===e.api?(window.mainButton=e.mainButton,window.extensionName=e.extensionName,a()):"userLogin"===e.api?(window.userLogin=e.isLogin,a()):"updateUserCache"===e.api&&(window.userData=e.userData,window.access_token=e.access_token,a()),!0)),chrome.runtime.onInstalled.addListener((function(e){chrome.tabs.query({currentWindow:!0},(function(e){const t=chrome.runtime.getManifest().content_scripts[0].js[0];for(let n=0;n<e.length;n++)chrome.tabs.executeScript(e[n].id,{file:t},e=>{})}))}));let r=!0;r&&chrome.tabs.onUpdated.addListener((e,t,n)=>{console.log("changeInfo.status",t.status),"complete"===t.status&&n.url.includes("figma.com")&&chrome.tabs.executeScript(e,{file:"app/app.bundle.js"},()=>{})})},35:function(e,t){window.API_URL="https://api.animaapp.com",window.API_PROJECT="https://projects.animaapp.com"},36:function(e,t){var n=!1;let a,r=null;chrome.runtime.onMessage.addListener((e,t,s)=>{if("getFigmaDesignFromAnima"===e.api){r=t.tab.id,n=!1,clearTimeout(a),a=setTimeout(()=>{n=!0},36e4),t&&t.tab&&t.tab.id&&o.push(t.tab.id);let i=e.data,c=e.accessToken;i.fileId;(async function(e,t){const a={method:"POST",headers:{"Content-Type":"application/json",Authorization:t="JWT "+t},body:JSON.stringify(e)};let r;try{r=await fetch("https://figma-service.animaapp.com/generate/async",a)}catch(e){console.error(e)}if(200==r.status||201==r.status){n=!1;let e,a=await r.json();try{e=await async function e(t){let a=await async function(e,t){const n={method:"POST",headers:{"Content-Type":"application/json",Authorization:e.accessToken},body:JSON.stringify(e)};let a;try{a=await fetch("https://figma-service.animaapp.com/task/callback",n)}catch(e){console.error(e)}if(400===a.status)return a;if(200===a.status)return a;if(204===a.status)return chrome.tabs.getAllInWindow(e=>{e.map(e=>{chrome.tabs.sendMessage(e.id,{to:"AnimaStore",message:"add-percentage"},null,()=>{})})}),new Promise(e=>{setTimeout(()=>{e(a)},2e3)})}(t);if(a.error)return a;if(400===a.status)return a=await a.json(),a;if(204===a.status&&!n)return await e(t);if(200===a.status){return function(e){let t=e.project_short_id,n=e.homepage_slug,a=e.short_id;return`http://projects.animaapp.com/p/${t}/${a}/${n}/syncwebsite?extensionName=${window.extensionName}`}(await a.json())}if(n)return{error:"Error: convert Figma file to design failed"}}({taskId:a.taskId,accessToken:t})}catch(e){return{error:"Error: convert Figma file to design failed"}}if(e.error)return e;let o=e.replace("projects.","canary-projects.").replace("prototype","omniview"),s=e.replace("projects.animaapp.com","localhost:5002").replace("prototype","omniview").replace("https","http"),i=e.replace("prototype","omniview");return console.log("canaryUrl",o),console.log("localhostUrl",s),console.log("prodUrl",i),window.API_PROJECT.includes("https://projects.animaapp.com")?i:o}return 400===r.status?(r=await r.json(),{error:r.message}):{error:"Error: async design failed"}})(i,c).then(e=>{clearTimeout(a),e&&setTimeout(()=>{s(e)},2e3)})}return!0});let o=[]},37:function(e,t){let n,a=!1,r=[];chrome.runtime.onMessage.addListener((e,t,a)=>{let c={platform:"figma",to:e.type?e.type:"login"};return"getLoginUrl"===e.api?(t&&t.tab&&t.tab.id&&r.push(t.tab.id),clearTimeout(n),n=setTimeout(()=>{clearInterval(this.intervalInstance)},18e4),i(null,c,e.dontAddSource).then(e=>{a(e)})):"getFigmaAccessToken"===e.api?o(e.body,e.access_token):"checkIfWeHaveStorageUser"===e.api?a({userData:window.userData,access_token:window.access_token}):"getUserAfterLogin"===e.api&&l(e.data.pairingToken,c).then(e=>{t&&t.tab&&t.tab.id&&r.push(t.tab.id);let n={headers:{"X-Client-Id":"com.animaapp.figma","X-Client-Version":"0.0.1",Authorization:"JWT "+e.access_token}};s(n).then(t=>{window.userData=t,window.access_token=e.access_token,a({user:t,access_token:e.access_token})})}),!0});const o=async(e,t)=>{const n=window.API_URL+"/figma_token/generate",a={method:"POST",headers:{"Content-Type":"application/json","X-Client-Id":"com.animaapp.figma","X-Client-Version":"0.0.1",Authorization:"JWT "+t},body:e};await fetch(n,a)},s=async e=>{const t=window.API_URL+"/users/me",n={method:"GET",headers:{"Content-Type":"application/json"}};e.headers&&(n.headers=Object.assign(n.headers,e.headers));let a=await fetch(t,n);if(200==a.status){return await a.json()}{console.log("ERROR GETTING CURRENT USER > ",a);let e=await a.json();if(e.error){let t=new Error(e.description||"Something went wrong!");throw t.statusCode=e.status_code||a.status||500,t.error=e.error||"Error",t}{let e=new Error("Something went wrong!");throw e.statusCode=a.status||500,e.error="Error",e}}},i=async(e,t={},n)=>{try{if(!e){e=(await c(t)).token}let a=`${window.API_PROJECT}/${t&&t.to&&"signup"===t.to?"signup":"login"}?pairing=true&pt=${e}&platform=${t.platform}`;return t&&(a+=n||`&platform=${t.platform}&utm_medium=plugin&utm_source=figma&utm_content=signup-button`),{url:a,pairingToken:e}}catch(e){throw console.log("ERROR > GETTING BROWSER LOGIN URL > ",e),e}},c=async(e={})=>{try{a=!1;const t=window.API_URL+"/rpc/generate_pairing_token",n={method:"POST",headers:{"Content-Type":"application/json"}};e.headers&&(n.headers=Object.assign(n.headers,e.headers));let r=await fetch(t,n);if(200==r.status){return await r.json()}let o=await r.json();if(o.error){let e=new Error(o.description||"Something went wrong!");throw e.statusCode=o.status_code||r.status||500,e.error=o.error||"Error",e}{let e=new Error("Something went wrong!");throw e.statusCode=r.status||500,e.error="Error",e}}catch(e){throw console.log("ERROR > GENERATING PAIRING TOKEN > ",e),e}},l=async(e,t={})=>new Promise(async(n,r)=>{try{if(!e){let n=await this.generatePairingToken(t);e=n.token}const o=async()=>{try{let a=await u(e,t);a.result&&"ok"==a.result&&(clearInterval(this.intervalInstance),n(a))}catch(e){console.error("ERROR > GETTING ACCESS TOKEN > "),clearInterval(this.intervalInstance),r(e)}};a||(this.intervalInstance=setInterval(o,2e3))}catch(e){console.log("ERROR > GETTING ACCESS TOKEN > ",e),r(e)}}),u=async(e,t={})=>{try{const n=`${window.API_URL}/rpc/pairing_token?t=${e}`,a={method:"GET",headers:{"Content-Type":"application/json"}};t.headers&&(a.headers=Object.assign(a.headers,t.headers));let r=await fetch(n,a);if(200==r.status){return await r.json()}let o=await r.json();if(o.error){let e=new Error(o.description||"Something went wrong!");throw e.statusCode=o.status_code||r.status||500,404==e.statusCode&&(e.message="Failed to pair. Please try again!"),e.error=o.error||"Error",e}{let e=new Error("Something went wrong!");throw e.statusCode=r.status||500,404==e.statusCode&&(e.message="Failed to pair. Please try again!"),e.error="Error",e}}catch(e){throw console.log("ERROR > GENERATING AUTH URL > ",e),e}};function d(e){r.find(t=>t===e)&&clearInterval(this.intervalInstance)}chrome.tabs.onRemoved.addListener(e=>{d(e)}),chrome.tabs.onUpdated.addListener(e=>{d(e)})},38:function(e,t){let n=!1;function a(e,t,n,a={}){var o={eventCategory:"General",eventAction:e||"",uid:r};a.extensionName=window.extensionName,o.params=JSON.stringify(a);var s=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="&"),t+=encodeURI(n+"="+e[n]));return t}(o),i=new XMLHttpRequest;i.open("POST","https://logs.animaapp.com/analytics/collect",!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("X-User-Email",n||""),i.setRequestHeader("X-Client-Id","com.animaapp.chrome.extension"),i.setRequestHeader("X-Client-Version","1.0.0"),i.send(s)}chrome.runtime.onMessage.addListener((e,t,s)=>{if("trackEvent"===e.api){if(t&&t.origin&&"string"==typeof t.origin&&t.origin.includes(".figma.")){let t=e.params?e.params:{};a(e.eventName,e.userId,e.userEmail,t)}}else"firstRefresh"===e.api?(r=e.UUID,n&&(n=!1,setTimeout(()=>{a("chrome.extension.installed","","")},5e3))):"alias"===e.api&&async function(e,t){if(r&&e){const n={alias:e,distinct_id:r};try{let a="https://logs.animaapp.com/analytics/register_alias";await function(e,t,n,a){return new Promise((r,s)=>{const i=o(t),c=new XMLHttpRequest;c.open("POST",e,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.setRequestHeader("X-User-Id",n||""),c.setRequestHeader("X-User-Email",a||""),c.setRequestHeader("X-Client-Id","com.animaapp.chrome.extension"),c.setRequestHeader("X-Client-Version","1.0.0");for(const e in this.headers){const t=this.headers[e];c.setRequestHeader(e,t)}c.onreadystatechange=function(){4===c.readyState&&200===c.status?s(c.response):r({status:c.status,statusText:c.statusText})},c.onerror=function(){r({status:c.status,statusText:c.statusText})},c.send(i)})}(a,n,e,t)}catch(e){console.log("register_alias failed",e)}}}(e.userId,e.email);return!0});let r=null;chrome.runtime.onInstalled.addListener((function(e){"install"==e.reason&&(n=!0)}));const o=e=>{let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="&"),t+=encodeURI(n+"="+e[n]));return t}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2JhY2tncm91bmQvYmFja2dyb3VuZC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kQ29uZmlnRmlsZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kR2V0RmlnbWFQcmV2aWV3LmpzIiwid2VicGFjazovLy8uL3NyYy9iYWNrZ3JvdW5kL2JhY2tncm91bmRMb2dpbi5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kVHJhY2tpbmcuanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJhc3luYyIsImxvYWRVbmluc3RhbGxQYWdlIiwiZW1haWwiLCJ3aW5kb3ciLCJleHRlbnNpb25OYW1lIiwibG9hZEZyb21CYWNrZ3JvdW5kUGFnZSIsInVzZXJEYXRhIiwiY2hyb21lIiwicnVudGltZSIsInNldFVuaW5zdGFsbFVSTCIsIkFQSV9QUk9KRUNUIiwidXNlckxvZ2luIiwibWFpbkJ1dHRvbiIsImFjY2Vzc190b2tlbiIsIm9uTWVzc2FnZSIsImFkZExpc3RlbmVyIiwibWVzc2FnZSIsInNlbmRlciIsInNlbmRSZXNwb25zZSIsImFwaSIsInVybCIsImJvZHkiLCJtZXRob2QiLCJoZWFkZXJzIiwib3ZlcndyaXRlVXJsIiwicGFyYW1zIiwiYmFzZVVybCIsIkFQSV9VUkwiLCJyZXFPYmoiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsInRvVGV4dCIsInRleHQiLCJqc29uIiwiZXJyb3IiLCJkYXRhIiwiaGVhZGVyIiwidGhlbiIsInJlcyIsInRhYnMiLCJnZXRBbGxJbldpbmRvdyIsIm1hcCIsInRhYiIsInNlbmRNZXNzYWdlIiwiaWQiLCJpc0xvZ2luIiwib25JbnN0YWxsZWQiLCJkZXRhaWxzIiwicXVlcnkiLCJjdXJyZW50V2luZG93IiwiY29udGVudGpzRmlsZSIsImdldE1hbmlmZXN0IiwiY29udGVudF9zY3JpcHRzIiwianMiLCJpbmRleCIsImxlbmd0aCIsImV4ZWN1dGVTY3JpcHQiLCJmaWxlIiwicmVzdWx0Iiwib25VcGRhdGVkIiwidGFiSWQiLCJjaGFuZ2VJbmZvIiwiY29uc29sZSIsImxvZyIsImluY2x1ZGVzIiwic3RvcFRyeVRvR2V0RGVzaWduIiwic3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0IiwidGFiSWRPZkRlc2lnbiIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJjaGVja1VwZGF0ZWRUYWJzIiwicHVzaCIsImFjY2Vzc1Rva2VuIiwiZmlsZUlkIiwiZSIsInByZXZpZXciLCJnZXRGaWdtYURlc2lnbiIsInRvIiwiUHJvbWlzZSIsInJlc29sdmVkIiwiZ2V0RmlnbWFEZXNpZ25BUEkiLCJwcm9qZWN0U2hvcnRJZCIsInByb2plY3Rfc2hvcnRfaWQiLCJob21lcGFnZV9zbHVnIiwicmVsZWFzZVNob3J0SWQiLCJzaG9ydF9pZCIsImNvdmVydFdlYlVybCIsInRhc2tJZCIsImNhbmFyeVVybCIsInJlcGxhY2UiLCJsb2NhbGhvc3RVcmwiLCJwcm9kVXJsIiwic3RhcnRGZXRjaGluZ0ZpZ21hRGVzZ2luIiwic3RvcExvb2tGb3JMb2dpblBvbGxpbmciLCJzdG9wUG9sbGluZyIsImNoZWNrVGFic0FyZVVwZGF0ZU9yUmVtb3ZlZCIsIm9wdGlvbnMiLCJwbGF0Zm9ybSIsInR5cGUiLCJjbGVhckludGVydmFsIiwidGhpcyIsImludGVydmFsSW5zdGFuY2UiLCJnZXRCcm93c2VyTG9naW5VcmwiLCJkb250QWRkU291cmNlIiwiYnJvd3NlclVybCIsImdldEZpZ21hQWNjZXNzVG9rZW4iLCJnZXRBY2Nlc3NUb2tlbiIsInBhaXJpbmdUb2tlbiIsImF1dGhPcHRpb25zIiwiQXV0aG9yaXphdGlvbiIsImN1cnJlbnRVc2VyIiwidXNlciIsImFzc2lnbiIsImVycm9yT2JqIiwiRXJyb3IiLCJkZXNjcmlwdGlvbiIsInN0YXR1c0NvZGUiLCJzdGF0dXNfY29kZSIsImdlbmVyYXRlUGFpcmluZ1Rva2VuIiwidG9rZW4iLCJleGVjIiwicmVzb2x2ZSIsInJlamVjdCIsInJlc3AiLCJjaGVja1BvbGxpbmdVcmwiLCJwb2xsaW5nVXJsIiwic2V0SW50ZXJ2YWwiLCJjaGVja0lmVGFiVXBkYXRlZDEiLCJmaW5kIiwiZmluZFRhYiIsIm9uUmVtb3ZlZCIsInNlbmRGaXJzdEluc3RhbGxFdmVudCIsInNlbmRUcmFja0V2ZW50IiwiZXZlbnROYW1lIiwidXNlcklkIiwidXNlckVtYWlsIiwiYXJncyIsImV2ZW50Q2F0ZWdvcnkiLCJldmVudEFjdGlvbiIsInVpZCIsIlVVSUQiLCJlbmNvZGVkU3RyaW5nIiwicHJvcCIsImVuY29kZVVSSSIsInBhcmFtZXRpemUiLCJodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInNlbmQiLCJvcmlnaW4iLCJhbGlhcyIsImRpc3RpbmN0X2lkIiwicGFyYW1ldGVyaXplIiwiaCIsInYiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzVGV4dCIsIm9uZXJyb3IiLCJzZW5kUmVxdWVzdCIsInJlYXNvbiIsIm9iaiJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JD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QUl4SyxlQUFlb0osS0FDakJELEVBQWN0RixPQUFTLElBQ3pCc0YsR0FBaUIsS0FFbkJBLEdBQWlCRSxVQUFVRCxFQUFPLElBQU1vQixFQUFJcEIsS0FHaEQsT0FBT0QiLCJmaWxlIjoiYmFja2dyb3VuZC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMzQpO1xuIiwiaW1wb3J0IFwiLi9iYWNrZ3JvdW5kQ29uZmlnRmlsZS5qc1wiO1xuaW1wb3J0IFwiLi9iYWNrZ3JvdW5kR2V0RmlnbWFQcmV2aWV3XCI7XG5pbXBvcnQgXCIuL2JhY2tncm91bmRMb2dpbi5qc1wiO1xuaW1wb3J0IFwiLi9iYWNrZ3JvdW5kVHJhY2tpbmcuanNcIjtcblxud2luZG93LnVzZXJMb2dpbiA9IGZhbHNlO1xud2luZG93Lm1haW5CdXR0b24gPSBcImNvZGVcIjtcbndpbmRvdy5leHRlbnNpb25OYW1lID0gbnVsbDtcbndpbmRvdy51c2VyRGF0YTtcbndpbmRvdy5hY2Nlc3NfdG9rZW47XG5cbmNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcigobWVzc2FnZSwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpID0+IHtcbiAgLyppZiAobWVzc2FnZS5hcGkgPT09IFwiZ2V0RmVhdHVyZUZsYWdcIikge1xuICAgICAgICBsb2FkRmVhdHVyZUZsYWcoKS50aGVuKChmZWF0dXJlRmxhZ3MpPT57XG4gICAgICAgICAgICBzZW5kUmVzcG9uc2UoZmVhdHVyZUZsYWdzKVxuICAgICAgICB9KVxuICAgIH0gXG4gICAgZWxzZSovIGlmIChcbiAgICBtZXNzYWdlLmFwaSA9PSBcInNlbmRBcGlcIlxuICApIHtcbiAgICBhcGkoXG4gICAgICBtZXNzYWdlLnVybCxcbiAgICAgIG1lc3NhZ2UuZGF0YSxcbiAgICAgIG1lc3NhZ2UubWV0aG9kLFxuICAgICAgbWVzc2FnZS5oZWFkZXIsXG4gICAgICBtZXNzYWdlLm92ZXJ3cml0ZVVybFxuICAgICkudGhlbigocmVzKSA9PiB7XG4gICAgICBzZW5kUmVzcG9uc2UocmVzKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJsb2dvdXRcIikge1xuICAgIGxvZ291dEluQWxsVGFicygpO1xuICB9IGVsc2UgaWYgKG1lc3NhZ2UuYXBpID09PSBcImxvYWRGZWF0dXJlRmxhZ1wiKSB7XG4gICAgd2luZG93Lm1haW5CdXR0b24gPSBtZXNzYWdlLm1haW5CdXR0b247XG4gICAgd2luZG93LmV4dGVuc2lvbk5hbWUgPSBtZXNzYWdlLmV4dGVuc2lvbk5hbWU7XG4gICAgbG9hZFVuaW5zdGFsbFBhZ2UoKTtcbiAgfSBlbHNlIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJ1c2VyTG9naW5cIikge1xuICAgIHdpbmRvdy51c2VyTG9naW4gPSBtZXNzYWdlLmlzTG9naW47XG4gICAgbG9hZFVuaW5zdGFsbFBhZ2UoKTtcbiAgfSBlbHNlIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJ1cGRhdGVVc2VyQ2FjaGVcIikge1xuICAgIHdpbmRvdy51c2VyRGF0YSA9IG1lc3NhZ2UudXNlckRhdGE7XG4gICAgd2luZG93LmFjY2Vzc190b2tlbiA9IG1lc3NhZ2UuYWNjZXNzX3Rva2VuO1xuICAgIGxvYWRVbmluc3RhbGxQYWdlKCk7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59KTtcblxuZnVuY3Rpb24gbG9nb3V0SW5BbGxUYWJzKCkge1xuICB3aW5kb3cudXNlckRhdGEgPSBudWxsO1xuICB3aW5kb3cuYWNjZXNzX3Rva2VuID0gbnVsbDtcblxuICAvLyBjaHJvbWUuc3RvcmFnZS5zeW5jLnNldCh7IGFjY2Vzc190b2tlbjogJycgfSwgZnVuY3Rpb24gKHgpIHt9KTtcbiAgLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyB1c2VyRGF0YToge30gfSwgZnVuY3Rpb24gKHgpIHt9KTtcbiAgLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoe2NhY2hlUHJvamVjdHM6W119KS8vc2F2ZSB0aGF0IHRoZSBwcm9qZWN0IGlzIHJlbGF0ZWQgZm9yIHRoaXMgdGVhbSBpZFxuXG4gIGNocm9tZS50YWJzLmdldEFsbEluV2luZG93KCh0YWJzKSA9PiB7XG4gICAgdGFicy5tYXAoKHRhYikgPT4ge1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7IG1lc3NhZ2U6IFwibG9nb3V0XCIgfSwgbnVsbCwgKCkgPT4ge30pO1xuICAgIH0pO1xuICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGFwaShcbiAgdXJsLFxuICBib2R5LFxuICBtZXRob2QgPSBcIkdFVFwiLFxuICBoZWFkZXJzLFxuICBvdmVyd3JpdGVVcmwgPSBmYWxzZSxcbiAgcGFyYW1zXG4pIHtcbiAgbGV0IGJhc2VVcmwgPVxuICAgIGJvZHkgJiYgYm9keS5iYXNlVXJsID09PSBcInByb2plY3RzXCIgPyB3aW5kb3cuQVBJX1BST0pFQ1QgOiB3aW5kb3cuQVBJX1VSTDtcblxuICBpZiAoaGVhZGVycyAmJiBoZWFkZXJzLmJhc2VVcmwgPT09IFwibG9jYWxob3N0XCIpIHtcbiAgICBiYXNlVXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjUwMDdcIjtcbiAgfVxuICBjb25zdCBBUElfVVJMID0gb3ZlcndyaXRlVXJsID8gdXJsIDogYCR7YmFzZVVybH0ke3VybH1gO1xuXG4gIGlmIChib2R5ICYmIGJvZHkuYmFzZVVybCkge1xuICAgIGRlbGV0ZSBib2R5LmJhc2VVcmw7XG4gIH1cblxuICBjb25zdCByZXFPYmogPSB7XG4gICAgbWV0aG9kLFxuICAgIGhlYWRlcnMsXG4gICAgYm9keTogYm9keSA/IEpTT04uc3RyaW5naWZ5KGJvZHkpIDogbnVsbCxcbiAgfTtcblxuICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChBUElfVVJMLCByZXFPYmopO1xuXG4gIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgaWYgKGhlYWRlcnMgJiYgaGVhZGVycy50b1RleHQpIHtcbiAgICAgIGxldCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIGpzb247XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIHJldHVybiB7IGVycm9yOiBqc29uIH07XG4gIH1cbn1cbi8vIGFzeW5jIGZ1bmN0aW9uIGxvYWRGZWF0dXJlRmxhZygpe1xuLy8gICAgIGxldCB0ZXh0ID0gJydcbi8vICAgICB0cnl7XG4vLyAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9zcHJlYWRzaGVldHMvZC8xLXFyMVExYk9Qck84M28wR0RaVzAzcU5nTmRURGhXblkwS0ZJUWUxVGV2OC9leHBvcnQ/Zm9ybWF0PWNzdiZpZD0xLXFyMVExYk9Qck84M28wR0RaVzAzcU5nTmRURGhXblkwS0ZJUWUxVGV2OCZnaWQ9MTA3MjI1MjY5MycpXG4vLyAgICAgICAgIHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4vLyAgICAgfVxuLy8gICAgIGNhdGNoKGUpe1xuLy8gICAgICAgICBjb25zb2xlLmVycm9yKGUpXG4vLyAgICAgfVxuXG4vLyAgICAgcmV0dXJuIHRleHRcbi8vIH1cbi8vIGxvYWRGZWF0dXJlRmxhZygpXG5cbmNocm9tZS5ydW50aW1lLm9uSW5zdGFsbGVkLmFkZExpc3RlbmVyKGluc3RhbGxTY3JpcHQpO1xuXG5mdW5jdGlvbiBpbnN0YWxsU2NyaXB0KGRldGFpbHMpIHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIGN1cnJlbnRXaW5kb3c6IHRydWUsXG4gIH07XG5cbiAgY2hyb21lLnRhYnMucXVlcnkocGFyYW1zLCBmdW5jdGlvbiBnb3RUYWJzKHRhYnMpIHtcbiAgICBjb25zdCBjb250ZW50anNGaWxlID0gY2hyb21lLnJ1bnRpbWUuZ2V0TWFuaWZlc3QoKS5jb250ZW50X3NjcmlwdHNbMF0uanNbMF07XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRhYnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KFxuICAgICAgICB0YWJzW2luZGV4XS5pZCxcbiAgICAgICAge1xuICAgICAgICAgIGZpbGU6IGNvbnRlbnRqc0ZpbGUsXG4gICAgICAgIH0sXG4gICAgICAgIChyZXN1bHQpID0+IHt9XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIGZ1bmN0aW9uIGdldFVzZXJJZCgpIHtcbi8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCkgPT4ge1xuLy8gICAgIHdpbmRvdy5jaHJvbWUuc3RvcmFnZS5zeW5jLmdldChcInVzZXJEYXRhXCIsIChkYXRhKSA9PiB7XG4vLyAgICAgICByZXNvbHZlZChkYXRhKVxuLy8gICAgIH0pO1xuLy8gICB9KTtcbi8vIH1cblxuZnVuY3Rpb24gZ2V0RXh0RGF0YSgpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCkgPT4ge1xuICAgIGNocm9tZS5tYW5hZ2VtZW50LmdldFNlbGYoKGRhdGEpID0+IHtcbiAgICAgIHJlc29sdmVkKGRhdGEpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbG9hZFVuaW5zdGFsbFBhZ2UoZW1haWwpIHtcbiAgaWYgKHdpbmRvdy5leHRlbnNpb25OYW1lICE9PSBcImFuaW1hXCIgfHwgbG9hZEZyb21CYWNrZ3JvdW5kUGFnZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh3aW5kb3cudXNlckRhdGEpIHtcbiAgICBjb25zdCBlbWFpbCA9XG4gICAgICB3aW5kb3cudXNlckRhdGEgJiYgd2luZG93LnVzZXJEYXRhLmVtYWlsID8gd2luZG93LnVzZXJEYXRhLmVtYWlsIDogXCJcIjtcblxuICAgIGlmIChlbWFpbCkge1xuICAgICAgY2hyb21lLnJ1bnRpbWUuc2V0VW5pbnN0YWxsVVJMKFxuICAgICAgICBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9L2Nocm9tZS1leHRlbnNpb24tdW5pbnN0YWxsP2VtYWlsPSR7ZW1haWx9YFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hyb21lLnJ1bnRpbWUuc2V0VW5pbnN0YWxsVVJMKFxuICAgICAgICBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9L2Nocm9tZS1leHRlbnNpb24tdW5pbnN0YWxsYFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbi8vIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcigodGFiSWQsY2hhbmdlSW5mbyx0YWIpID0+IHsvL2NoZWNrIGlmIHRoZSB0YWIgdXBkYXRlZFxuLy8gICBpZih0YWIudXJsLmluY2x1ZGVzKCdmaWdtYS5jb20nKSAmJiBjaGFuZ2VJbmZvLnN0YXR1cyA9PT0gJ2xvYWRpbmcnICYmIGFsbEJ1bmRsZUZpbGUpe1xuLy8gY2hyb21lLnRhYnMuZXhlY3V0ZVNjcmlwdCh0YWJJZCx7XG4vLyAgICAgY29kZTogYWxsQnVuZGxlRmlsZVxuLy8gfSwoYSxiKT0+e1xuLy8gICBjb25zb2xlLmxvZyhhKVxuLy8gICBjb25zb2xlLmxvZyhiKVxuLy8gfSlcblxuLy8gcmV0dXJuXG4vLyBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KHRhYklkLHtcbi8vICAgY29kZTogYWxsQnVuZGxlRmlsZSxcbi8vICAgLy8gZmlsZTpcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9zaGFyZS9hcHAuYnVuZGxlLmpzXCIsXG4vLyAgIGFsbEZyYW1lczogdHJ1ZVxuLy8gfSk7XG4vLyBleGVjdXRpbmcudGhlbihvbkV4ZWN1dGVkLCBvbkVycm9yKTtcbi8vICAgfVxuLy8gfSk7XG5cbmxldCBsb2FkRnJvbUJhY2tncm91bmRQYWdlID0gdHJ1ZTtcblxuaWYgKGxvYWRGcm9tQmFja2dyb3VuZFBhZ2UpIHtcbiAgY2hyb21lLnRhYnMub25VcGRhdGVkLmFkZExpc3RlbmVyKCh0YWJJZCwgY2hhbmdlSW5mbywgdGFiKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJjaGFuZ2VJbmZvLnN0YXR1c1wiLCBjaGFuZ2VJbmZvLnN0YXR1cyk7XG4gICAgaWYgKGNoYW5nZUluZm8uc3RhdHVzID09PSBcImNvbXBsZXRlXCIgJiYgdGFiLnVybC5pbmNsdWRlcyhcImZpZ21hLmNvbVwiKSkge1xuICAgICAgLy8gY2hyb21lLnRhYnMuZXhlY3V0ZVNjcmlwdCh0YWJJZCwgeyBmaWxlOiBcImFwcC5idW5kbGUuanNcIiB9LCAoKSA9PiB7fSk7XG4gICAgICBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KHRhYklkLCB7IGZpbGU6IFwiYXBwL2FwcC5idW5kbGUuanNcIiB9LCAoKSA9PiB7fSk7IC8vZm9yIGdpdEh1YkRhcmtcbiAgICB9XG4gIH0pO1xufVxuLy8gZ2V0SnNGaWxlKClcbi8vIGxldCBhbGxCdW5kbGVGaWxlXG4vLyBhc3luYyBmdW5jdGlvbiBnZXRKc0ZpbGUoKXtcbi8vICAgbGV0IGRhdGEgPSBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL3NoYXJlL2FwcC5idW5kbGUuanMnLCB7XG4vLyAgICAgbWV0aG9kOiAnR0VUJyxcbi8vICAgfSk7XG5cbi8vICAgZGF0YSA9IGF3YWl0IGRhdGEudGV4dCgpXG4vLyAgIGFsbEJ1bmRsZUZpbGUgPSBkYXRhXG4vLyB9XG4iLCIvLyB3aW5kb3cuQVBJX1VSTCA9ICdodHRwczovL2NhbmFyeS1hcGkuYW5pbWFhcHAuY29tJ1xuLy8gd2luZG93LkFQSV9QUk9KRUNUID0gJ2h0dHBzOi8vY2FuYXJ5LXByb2plY3RzLmFuaW1hYXBwLmNvbSdcbi8vIHdpbmRvdy5BUElfUFJPSkVDVCA9ICdodHRwOi8vbG9jYWxob3N0OjUwMDInXG53aW5kb3cuQVBJX1VSTCA9ICdodHRwczovL2FwaS5hbmltYWFwcC5jb20nXG53aW5kb3cuQVBJX1BST0pFQ1QgPSAnaHR0cHM6Ly9wcm9qZWN0cy5hbmltYWFwcC5jb20nIiwidmFyIHN0b3BUcnlUb0dldERlc2lnbiA9IGZhbHNlXG5sZXQgc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0XG5sZXQgdGFiSWRPZkRlc2lnbiA9IG51bGxcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xuICAgIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJnZXRGaWdtYURlc2lnbkZyb21BbmltYVwiKSB7XG4gICAgICAgIHRhYklkT2ZEZXNpZ24gPSBzZW5kZXIudGFiLmlkXG4gICAgICAgIHN0b3BUcnlUb0dldERlc2lnbiA9IGZhbHNlXG4gICAgICAgIFxuICAgICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0KVxuICAgICAgICBzdG9wTG9va0ZvckRlc2lnblRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpPT57Ly9hZnRlciAzIG1pbnV0ZXMgc3RvcCB0cnlpbmcgdG8gZ2V0IHRoZSBkZXNpZ25cbiAgICAgICAgICAgIHN0b3BUcnlUb0dldERlc2lnbiA9IHRydWVcbiAgICAgICAgfSwoMzYwICogMTAwMCkpXG4gICAgICAgIFxuICAgICAgICBpZihzZW5kZXIgJiYgc2VuZGVyLnRhYiAmJiBzZW5kZXIudGFiLmlkKXsvL2lmIHRoaXMgdGFiIHdpbGwgY2xvc2Ugb3IgZGVsZXRlIHdlIHdpbGwgc3RvcCB0aGUgcG9sbGluZ1xuICAgICAgICAgICAgY2hlY2tVcGRhdGVkVGFicy5wdXNoKHNlbmRlci50YWIuaWQpLy93ZSB3aWxsIGNoZWNrIGlmIG9uZSBvZiB0aGUgdGFicyBpbiB0aGlzIGxpc3QgaGFzIGNsb3NlZCBvciB1cGRhdGVkXG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGEgPSBtZXNzYWdlLmRhdGFcbiAgICAgICAgbGV0IGFjY2Vzc1Rva2VuID0gbWVzc2FnZS5hY2Nlc3NUb2tlblxuXG4gICAgICAgIGxldCBmaWxlSWQgPSBkYXRhLmZpbGVJZFxuICAgICAgICBzdGFydEZldGNoaW5nRmlnbWFEZXNnaW4oZGF0YSwgYWNjZXNzVG9rZW4pLnRoZW4odXJsPT57XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0KVxuICAgICAgICAgICAgaWYodXJsKXtcbiAgICAgICAgICAgICAgICAvLyBpZighdXJsLmVycm9yKXtcbiAgICAgICAgICAgICAgICAvLyAgICAgc2F2ZVVybEluQ2FjaGUodXJsLGZpbGVJZClcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UodXJsKVxuICAgICAgICAgICAgICAgIH0sMjAwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9IFxuICAgIFxuICAgIHJldHVybiB0cnVlXG59KTtcblxuLy8gZnVuY3Rpb24gc2F2ZVVybEluQ2FjaGUodXJsLGZpbGVJZCl7Ly9zYXZlIHRoZSBkZXNpZ24gaW4gY2FjaGVcbi8vICAgICBjaHJvbWUuc3RvcmFnZS5zeW5jLmdldCgnZXhwb3J0RmlsZXMnLCAoZGF0YSkgPT4ge1xuLy8gICAgICAgICBsZXQgZmlsZSA9IHtcbi8vICAgICAgICAgICAgICAgICAgICAgZmlsZUlkLFxuLy8gICAgICAgICAgICAgICAgICAgICB1cmwsXG4vLyAgICAgICAgICAgICAgICAgICAgIHRpbWVIb3VyOm5ldyBEYXRlKCkuZ2V0SG91cnMoKSxcbi8vICAgICAgICAgICAgICAgICAgICAgZGF5OiBuZXcgRGF0ZSgpLmdldERhdGUoKVxuLy8gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgXG4vLyAgICAgICAgIGlmKCFkYXRhIHx8ICFkYXRhLmV4cG9ydEZpbGVzKXtcbi8vICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHtleHBvcnRGaWxlczpbZmlsZV19LCBmdW5jdGlvbiAoZGF0YSkge30pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgICAgZGF0YS5leHBvcnRGaWxlcy5wdXNoKGZpbGUpXG4vLyAgICAgICAgICAgICBsZXQgZmluZCA9IGRhdGEuZXhwb3J0RmlsZXMuZmluZChkZXNpZ249PntyZXR1cm4gZGVzaWduLmZpbGVJZD09PWZpbGVJZH0pXG4vLyAgICAgICAgICAgICBpZighZmluZCl7XG4vLyAgICAgICAgICAgICAgICAgY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoe2V4cG9ydEZpbGVzOmRhdGEuZXhwb3J0RmlsZXN9LCBmdW5jdGlvbiAoZGF0YSkge30pO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSk7XG4vLyB9XG5cbi8vIGZ1bmN0aW9uIGNoZWNrRGVzaWduSW5TdG9yYWdlKGRhdGEpe1xuLy8gICAgIGxldCBmaWxlSWQgPSBkYXRhLmZpbGVJZFxuLy8gICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZWQpPT57XG4vLyAgICAgICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KCdleHBvcnRGaWxlcycsIChkYXRhKSA9PiB7XG4vLyAgICAgICAgICAgICBpZighZGF0YSB8fCAhZGF0YS5leHBvcnRGaWxlcyl7XG4vLyAgICAgICAgICAgICAgICAgcmVzb2x2ZWQoKVxuLy8gICAgICAgICAgICAgICAgIHJldHVyblxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgbGV0IGZpbmQgPSBkYXRhLmV4cG9ydEZpbGVzLmZpbmQoZGVzaWduPT57cmV0dXJuIGRlc2lnbi5maWxlSWQgPT09IGZpbGVJZCAmJiBkZXNpZ24udGltZUhvdXIgPT09IG5ldyBEYXRlKCkuZ2V0SG91cnMoKX0pXG4vLyAgICAgICAgICAgICByZXNvbHZlZChmaW5kKVxuLy8gICAgICAgICB9KVxuLy8gICAgIH0pXG4vLyB9XG5hc3luYyBmdW5jdGlvbiBzdGFydEZldGNoaW5nRmlnbWFEZXNnaW4oYm9keSwgYWNjZXNzVG9rZW4pe1xuICAgIC8vIGxldCBkZXNpZ25JblN0b3JhZ2UgPSBhd2FpdCBjaGVja0Rlc2lnbkluU3RvcmFnZShib2R5KVxuICAgIC8vIGlmKGRlc2lnbkluU3RvcmFnZSAmJiBkZXNpZ25JblN0b3JhZ2UudXJsKXtcbiAgICAvLyAgICAgcmV0dXJuIGRlc2lnbkluU3RvcmFnZS51cmxcbiAgICAvLyB9XG5cbiAgICAvLyBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L2ZpZ21hX3Rva2VuL3ByZXZpZXdfbW9kZWwvYXN5bmNgO1xuICAgIC8vIGNvbnN0IEFQSV9VUkwgPSBgaHR0cHM6Ly91cy1jZW50cmFsMS1hbmltYS0yMTU5MTkuY2xvdWRmdW5jdGlvbnMubmV0L3Byb2Nlc3NGaWdtYS9nZW5lcmF0ZS9hc3luY2A7XG4gICAgY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2ZpZ21hLXNlcnZpY2UuYW5pbWFhcHAuY29tL2dlbmVyYXRlL2FzeW5jYDtcbiAgICBcbiAgICBhY2Nlc3NUb2tlbiA9IGBKV1QgJHthY2Nlc3NUb2tlbn1gXG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYWNjZXNzVG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgfTtcblxuICAgIGxldCByZXNwb25zZVxuICAgIHRyeXtcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChBUElfVVJMLCByZXFPYmopO1xuICAgIH1cbiAgICBjYXRjaChlKXtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKVxuICAgICAgICAvLyBpZihlLm1lc3NhZ2UgPT09ICdGYWlsZWQgdG8gZmV0Y2gnKXtcbiAgICAgICAgLy8gICAgIHJldHVybiB7ZXJyb3I6J0ludmFsaWQgdG9rZW4nfVxuICAgICAgICAvLyB9XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09IDIwMSkge1xuICAgICAgICBzdG9wVHJ5VG9HZXREZXNpZ24gPSBmYWxzZVxuICAgICAgICBcbiAgICAgICAgbGV0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgICAgbGV0IHByZXZpZXcgXG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIHByZXZpZXcgPSBhd2FpdCBnZXRGaWdtYURlc2lnbih7dGFza0lkOmpzb24udGFza0lkLGFjY2Vzc1Rva2VufSlcbiAgICAgICAgfVxuICAgICAgICBjYXRjaChlKXtcbiAgICAgICAgICAgIHJldHVybiB7ZXJyb3I6J0Vycm9yOiBjb252ZXJ0IEZpZ21hIGZpbGUgdG8gZGVzaWduIGZhaWxlZCd9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmKHByZXZpZXcuZXJyb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIHByZXZpZXdcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjYW5hcnlVcmwgPSBwcmV2aWV3LnJlcGxhY2UoJ3Byb2plY3RzLicsJ2NhbmFyeS1wcm9qZWN0cy4nKS5yZXBsYWNlKCdwcm90b3R5cGUnLCdvbW5pdmlldycpXG4gICAgICAgIGxldCBsb2NhbGhvc3RVcmwgPSBwcmV2aWV3LnJlcGxhY2UoJ3Byb2plY3RzLmFuaW1hYXBwLmNvbScsJ2xvY2FsaG9zdDo1MDAyJykucmVwbGFjZSgncHJvdG90eXBlJywnb21uaXZpZXcnKS5yZXBsYWNlKCdodHRwcycsJ2h0dHAnKVxuICAgICAgICBsZXQgcHJvZFVybCA9IHByZXZpZXcucmVwbGFjZSgncHJvdG90eXBlJywnb21uaXZpZXcnKVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2NhbmFyeVVybCcsY2FuYXJ5VXJsKVxuICAgICAgICBjb25zb2xlLmxvZygnbG9jYWxob3N0VXJsJyxsb2NhbGhvc3RVcmwpXG4gICAgICAgIGNvbnNvbGUubG9nKCdwcm9kVXJsJyxwcm9kVXJsKVxuXG4gICAgICAgIC8vIHJldHVybiBsb2NhbGhvc3RVcmxcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5BUElfUFJPSkVDVC5pbmNsdWRlcygnaHR0cHM6Ly9wcm9qZWN0cy5hbmltYWFwcC5jb20nKSA/IHByb2RVcmwgOiBjYW5hcnlVcmxcblxuICAgICAgICAvLyBsZXQgcHJvamVjdElkID0gcHJldmlldy5zcGxpdCgnL3AvJylbMV0uc3BsaXQoJy8nKVswXVxuICAgICAgICAvLyBsZXQgY29kZURlc2lnblxuICAgICAgICAvLyB0cnl7XG4gICAgICAgIC8vICAgICBjb2RlRGVzaWduID0gYXdhaXQgY29udmVydERlc2lnblRvQ29kZShwcmV2aWV3LCBwcm9qZWN0SWQsIGFjY2Vzc1Rva2VuKVxuICAgICAgICAvLyB9XG4gICAgICAgIC8vIGNhdGNoKGUpe1xuICAgICAgICAvLyAgICAgcmV0dXJuIHtlcnJvcjonU3luYyBkZXNpZ24gdG8gQW5pbWEgZmFpbGVkJ31cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBpZihjb2RlRGVzaWduLmVycm9yKXtyZXR1cm4gY29kZURlc2lnbn1cblxuICAgICAgICAvLyBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWJJZCwge3RvOiBcIkFuaW1hU3RvcmVcIixjaGFuZ2VUZXh0OiBcIlN5bmNpbmdcIn0pXG5cbiAgICAgICAgLy8gbGV0IHN5bmNEZXNpZ25SZXMgPSBhd2FpdCBzeW5jRGVzaWduKGNvZGVEZXNpZ24sIHByb2plY3RJZCwgYWNjZXNzVG9rZW4pXG4gICAgICAgIC8vIGlmKHN5bmNEZXNpZ25SZXMuZXJyb3Ipe3JldHVybiBzeW5jRGVzaWduUmVzfVxuXG4gICAgICAgIC8vIGxldCBwYWdlTmFtZSA9IHN5bmNEZXNpZ25SZXMucGFnZV9uYW1lcyA/IHN5bmNEZXNpZ25SZXMucGFnZV9uYW1lc1swXSA6ICcnXG4gICAgICAgIC8vIGxldCB1cmwgPSBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9L3RlYW0vbmV3MS1wN3puZ3ZsL3Byb2plY3QvJHtzeW5jRGVzaWduUmVzLnNob3J0X2lkfS9zY3JlZW4vJHtwYWdlTmFtZX0vb21uaXZpZXdgXG4gICAgICAgIFxuICAgICAgICAvLyBsZXQgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6NTAwMi90ZWFtL25ldzEtcDd6bmd2bC9wcm9qZWN0LyR7c3luY0Rlc2lnblJlcy5zaG9ydF9pZH0vc2NyZWVuLyR7cGFnZU5hbWV9L29tbml2aWV3YFxuXG4gICAgICAgIHJldHVybiB1cmxcbiAgICB9XG4gICAgZWxzZSBpZihyZXNwb25zZS5zdGF0dXMgPT09IDQwMCl7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgICAgIHJldHVybiB7ZXJyb3I6cmVzcG9uc2UubWVzc2FnZX1cbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICAgcmV0dXJuIHtlcnJvcjonRXJyb3I6IGFzeW5jIGRlc2lnbiBmYWlsZWQnfVxuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc3luY0Rlc2lnbihkYXRhLCBwcm9qZWN0SWQsIGFjY2Vzc1Rva2VuKXtcbiAgICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L3YyL3Byb2plY3RzLyR7cHJvamVjdElkfWA7XG4gICAgXG4gICAgbGV0IGJvZHkgPSB7XCJsaXZlX3Byb2plY3RfcmVsZWFzZVwiOntcInR5cGVcIjpcInByb2plY3RfcmVsZWFzZXNcIixcImlkXCI6ZGF0YS5pZH19XG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYWNjZXNzVG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgfTtcblxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gICAgdHJ5e1xuICAgICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgaWYoanNvbi5pc19zeW5jaW5nICYmICFzdG9wVHJ5VG9HZXREZXNpZ24pe1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCk9PntcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBzeW5jRGVzaWduKGRhdGEscHJvamVjdElkLGFjY2Vzc1Rva2VuKS50aGVuKGRhdGE9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSwyMDAwKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKHN0b3BUcnlUb0dldERlc2lnbil7XG4gICAgICAgICAgICByZXR1cm4ge2Vycm9yOlwiQ2FuJ3QgZXhwb3J0IHRoZSBkZXNpZ24gdG8gQW5pbWFcIn1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBqc29uXG4gICAgfVxuICAgIGNhdGNoKGUpe1xuICAgICAgICByZXR1cm4ge2Vycm9yOlwiQ2FuJ3QgZXhwb3J0IHRoZSBkZXNpZ24gdG8gQW5pbWFcIn1cbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBjb252ZXJ0RGVzaWduVG9Db2RlKHByZXZpZXcsIHByb2plY3RJZCwgYWNjZXNzVG9rZW4pe1xuICAgIGNvbnN0IEFQSV9VUkwgPSBgJHt3aW5kb3cuQVBJX1VSTH0vdjIvcHJvamVjdHMvJHtwcm9qZWN0SWR9L3Byb2plY3RfcmVsZWFzZXNgO1xuICAgIFxuICAgIGxldCBzaG9ydElkID0gcHJldmlldy5zcGxpdCgnL3AvJylbMV0uc3BsaXQoJy8nKVsxXVxuICAgIGxldCBib2R5ID0ge1wicmVsZWFzZVwiOntcInR5cGVcIjpcInJlbGVhc2VzXCIsXCJzaG9ydF9pZFwiOnNob3J0SWR9fVxuICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGFjY2Vzc1Rva2VuXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxuICAgIH07XG4gICAgXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBcbiAgICByZXR1cm4ganNvblxufVxuXG5mdW5jdGlvbiBjb3ZlcnRXZWJVcmwodXJsKXtcbiAgICBsZXQgcHJvamVjdFNob3J0SWQgPSB1cmwucHJvamVjdF9zaG9ydF9pZFxuICAgIGxldCBob21lcGFnZV9zbHVnID0gdXJsLmhvbWVwYWdlX3NsdWdcbiAgICBsZXQgcmVsZWFzZVNob3J0SWQgPSB1cmwuc2hvcnRfaWRcblxuICAgIC8vIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDo1MDAyL3AvJHtwcm9qZWN0U2hvcnRJZH0vJHtyZWxlYXNlU2hvcnRJZH0vJHtob21lcGFnZV9zbHVnfS9zeW5jd2Vic2l0ZT9leHRlbnNpb25OYW1lPSR7d2luZG93LmV4dGVuc2lvbk5hbWV9YFxuICAgIHJldHVybiBgaHR0cDovL3Byb2plY3RzLmFuaW1hYXBwLmNvbS9wLyR7cHJvamVjdFNob3J0SWR9LyR7cmVsZWFzZVNob3J0SWR9LyR7aG9tZXBhZ2Vfc2x1Z30vc3luY3dlYnNpdGU/ZXh0ZW5zaW9uTmFtZT0ke3dpbmRvdy5leHRlbnNpb25OYW1lfWBcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RmlnbWFEZXNpZ24oYm9keSl7XG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2V0RmlnbWFEZXNpZ25BUEkoYm9keSlcblxuICAgIGlmKHJlc3BvbnNlLmVycm9yKXtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuICAgIGVsc2UgaWYocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApe1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG4gICAgZWxzZSBpZihyZXNwb25zZS5zdGF0dXMgPT09IDIwNCAmJiAhc3RvcFRyeVRvR2V0RGVzaWduKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRGaWdtYURlc2lnbihib2R5KVxuICAgIH1cbiAgICBlbHNlIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGxldCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNvdmVydFdlYlVybChkYXRhKVxuICAgIH1cbiAgICBlbHNlIGlmKHN0b3BUcnlUb0dldERlc2lnbil7XG4gICAgICAgIHJldHVybiB7ZXJyb3I6J0Vycm9yOiBjb252ZXJ0IEZpZ21hIGZpbGUgdG8gZGVzaWduIGZhaWxlZCd9XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZ2V0RmlnbWFEZXNpZ25BUEkoYm9keSxhY2Nlc3NUb2tlbil7XG4gICAgLy8gY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9maWdtYV90b2tlbi90YXNrL2NhbGxiYWNrYDtcbiAgICAvLyBjb25zdCBBUElfVVJMID0gYGh0dHBzOi8vdXMtY2VudHJhbDEtYW5pbWEtMjE1OTE5LmNsb3VkZnVuY3Rpb25zLm5ldC9wcm9jZXNzRmlnbWEvdGFzay9jYWxsYmFja2A7XG4gICAgLy8gY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2FwaS5hbmltYWFwcC5jb20vZmlnbWFfdG9rZW4vdGFzay9jYWxsYmFja2A7XG4gICAgY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2ZpZ21hLXNlcnZpY2UuYW5pbWFhcHAuY29tL3Rhc2svY2FsbGJhY2tgO1xuXG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYm9keS5hY2Nlc3NUb2tlblxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICB9O1xuXG5cbiAgICBsZXQgcmVzcG9uc2VcbiAgICB0cnl7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICB9XG4gICAgY2F0Y2goZSl7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSlcbiAgICAgICAgLy8gaWYoZS5tZXNzYWdlID09PSAnRmFpbGVkIHRvIGZldGNoJyl7XG4gICAgICAgIC8vICAgICByZXR1cm4ge2Vycm9yOidJbnZhbGlkIHRva2VuJ31cbiAgICAgICAgLy8gfVxuICAgIH1cbiAgICBcbiAgICBpZihyZXNwb25zZS5zdGF0dXMgPT09IDQwMCl7XG4gICAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cbiAgICBlbHNlIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuICAgIGVsc2UgaWYocmVzcG9uc2Uuc3RhdHVzID09PSAyMDQpey8vaWYgdGhlIGZpbGUgaXMgc3RpbGwgcHJvY2Vzc2luZyB3YWl0IGZvciAxIHNlY29uZHNcbiAgICAgICAgY2hyb21lLnRhYnMuZ2V0QWxsSW5XaW5kb3coKHRhYnMpPT57XG4gICAgICAgICAgICB0YWJzLm1hcCh0YWI9PntcbiAgICAgICAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7dG86J0FuaW1hU3RvcmUnLG1lc3NhZ2U6J2FkZC1wZXJjZW50YWdlJ30sIG51bGwsICgpPT57fSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCk9PntcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICByZXNvbHZlZChyZXNwb25zZSlcbiAgICAgICAgICAgIH0sMjAwMClcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmxldCBjaGVja1VwZGF0ZWRUYWJzID0gW11cbi8vIGNocm9tZS50YWJzLm9uUmVtb3ZlZC5hZGRMaXN0ZW5lcigodGFiSWQpID0+IHsvL2NoZWNrIGlmIHRoZSB0YWIgZGVsZXRlZFxuLy8gICAgIGlmKHRhYklkID09PSB0YWJJZE9mRGVzaWduKXtcbi8vICAgICAgICAgY2hlY2tJZlRhYlVwZGF0ZWQodGFiSWQpXG4vLyAgICAgfVxuLy8gfSk7XG5cbi8vIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcigodGFiSWQsY2hhbmdlSW5mbyx0YWIpID0+IHsvL2NoZWNrIGlmIHRoZSB0YWIgdXBkYXRlZFxuLy8gICAgIGNvbnNvbGUubG9nKCdjaGFuZ2VJbmZvLnN0YXR1cycsY2hhbmdlSW5mby5zdGF0dXMpXG4vLyAgICAgaWYodGFiLnVybC5pbmNsdWRlcygnZmlnbWEuY29tJykgJiYgY2hhbmdlSW5mby5zdGF0dXMgPT09ICdsb2FkaW5nJyl7XG4vLyAgICAgICAgIGNocm9tZS50YWJzLmV4ZWN1dGVTY3JpcHQodGFiSWQse1xuLy8gICAgICAgICAgICAgY29kZTogYGFsZXJ0KCdpIGFtIGhlcmUnKTtgXG4vLyAgICAgICAgIH0pXG4vLyAgICAgfVxuLy8gICAgIC8vIGlmKGNoYW5nZUluZm8uc3RhdHVzID09PSAnbG9hZGluZycgJiYgdGFiSWQgPT09IHRhYklkT2ZEZXNpZ24pe1xuLy8gICAgIC8vICAgICBjaGVja0lmVGFiVXBkYXRlZCh0YWJJZClcbi8vICAgICAvLyB9XG4vLyB9KTtcbi8vIGZ1bmN0aW9uIGNoZWNrSWZUYWJVcGRhdGVkKHRhYklkKXsvL2lmIHRoZSB0YWIgZGVsZXRlZCBvciB1cGRhdGVkIHN0b3AgdGhlIHBvbGxpbmdcbi8vICAgICBsZXQgZmluZElmUmVmcmVzaGVkID0gY2hlY2tVcGRhdGVkVGFicy5maW5kKGZpbmRUYWI9PmZpbmRUYWI9PT10YWJJZClcbi8vICAgICBpZihmaW5kSWZSZWZyZXNoZWQpe1xuLy8gICAgICAgICBzdG9wVHJ5VG9HZXREZXNpZ24gPSB0cnVlXG4vLyAgICAgfVxuLy8gfSAiLCJsZXQgc3RvcFBvbGxpbmcgPSBmYWxzZVxubGV0IGNoZWNrVGFic0FyZVVwZGF0ZU9yUmVtb3ZlZCA9IFtdXG5sZXQgc3RvcExvb2tGb3JMb2dpblBvbGxpbmdcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xuICAgIGxldCBvcHRpb25zID0geyBwbGF0Zm9ybTogJ2ZpZ21hJywgdG86IG1lc3NhZ2UudHlwZSA/IG1lc3NhZ2UudHlwZSA6ICdsb2dpbid9O1xuICAgIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJnZXRMb2dpblVybFwiKSB7XG4gICAgICBpZihzZW5kZXIgJiYgc2VuZGVyLnRhYiAmJiBzZW5kZXIudGFiLmlkKXsvL2lmIHRoaXMgdGFiIHdpbGwgY2xvc2Ugb3IgZGVsZXRlIHdlIHdpbGwgc3RvcCB0aGUgcG9sbGluZ1xuICAgICAgICBjaGVja1RhYnNBcmVVcGRhdGVPclJlbW92ZWQucHVzaChzZW5kZXIudGFiLmlkKS8vd2Ugd2lsbCBjaGVjayBpZiBvbmUgb2YgdGhlIHRhYnMgaW4gdGhpcyBsaXN0IGhhcyBjbG9zZWQgb3IgdXBkYXRlZFxuICAgICAgfVxuICAgICAgXG4gICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JMb2dpblBvbGxpbmcpXG4gICAgICBzdG9wTG9va0ZvckxvZ2luUG9sbGluZyA9IHNldFRpbWVvdXQoKCk9PnsvL3N0b3AgdGhlIHBvbGxpbmcgYWZ0ZXIgMyBtaW51dGVzXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEluc3RhbmNlKVxuICAgICAgfSwxODAgKiAxMDAwKVxuICAgICAgXG4gICAgICBnZXRCcm93c2VyTG9naW5VcmwobnVsbCwgb3B0aW9ucyAsbWVzc2FnZS5kb250QWRkU291cmNlKS50aGVuKChicm93c2VyVXJsKT0+e1xuICAgICAgICAgIHNlbmRSZXNwb25zZShicm93c2VyVXJsKVxuICAgICAgfSlcbiAgICB9IFxuICAgIGVsc2UgaWYobWVzc2FnZS5hcGkgPT09IFwiZ2V0RmlnbWFBY2Nlc3NUb2tlblwiKXtcbiAgICAgIGdldEZpZ21hQWNjZXNzVG9rZW4obWVzc2FnZS5ib2R5LCBtZXNzYWdlLmFjY2Vzc190b2tlbilcbiAgICB9XG4gICAgZWxzZSBpZihtZXNzYWdlLmFwaSA9PT0gJ2NoZWNrSWZXZUhhdmVTdG9yYWdlVXNlcicpe1xuICAgICAgc2VuZFJlc3BvbnNlKHt1c2VyRGF0YTp3aW5kb3cudXNlckRhdGEsIGFjY2Vzc190b2tlbjp3aW5kb3cuYWNjZXNzX3Rva2VufSlcbiAgICB9XG4gICAgZWxzZSBpZiAobWVzc2FnZS5hcGkgPT09ICdnZXRVc2VyQWZ0ZXJMb2dpbicpe1xuICAgICAgICBnZXRBY2Nlc3NUb2tlbihtZXNzYWdlLmRhdGEucGFpcmluZ1Rva2VuICxvcHRpb25zKS50aGVuKChkYXRhKT0+e1xuICAgICAgICAgIGlmKHNlbmRlciAmJiBzZW5kZXIudGFiICYmIHNlbmRlci50YWIuaWQpe1xuICAgICAgICAgICAgY2hlY2tUYWJzQXJlVXBkYXRlT3JSZW1vdmVkLnB1c2goc2VuZGVyLnRhYi5pZClcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgYXV0aE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICdYLUNsaWVudC1JZCc6ICdjb20uYW5pbWFhcHAuZmlnbWEnLFxuICAgICAgICAgICAgICAnWC1DbGllbnQtVmVyc2lvbic6ICcwLjAuMScsXG4gICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBKV1QgJHtkYXRhLmFjY2Vzc190b2tlbn1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY3VycmVudFVzZXIoYXV0aE9wdGlvbnMpLnRoZW4odXNlcj0+e1xuICAgICAgICAgICAgd2luZG93LnVzZXJEYXRhID0gdXNlclxuICAgICAgICAgICAgd2luZG93LmFjY2Vzc190b2tlbiA9IGRhdGEuYWNjZXNzX3Rva2VuXG5cbiAgICAgICAgICAgIC8vIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHsgYWNjZXNzX3Rva2VuOiBkYXRhLmFjY2Vzc190b2tlbiB9LCBmdW5jdGlvbiAoeCkge30pO1xuICAgICAgICAgICAgLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyB1c2VyRGF0YTogdXNlciB9LCBmdW5jdGlvbiAoeCkge30pO1xuXG4gICAgICAgICAgICBzZW5kUmVzcG9uc2Uoe3VzZXIsIGFjY2Vzc190b2tlbjpkYXRhLmFjY2Vzc190b2tlbn0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbn0pO1xuXG5jb25zdCBnZXRGaWdtYUFjY2Vzc1Rva2VuID0gYXN5bmMgKGJvZHksIGFjY2Vzc190b2tlbikgPT4ge1xuICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L2ZpZ21hX3Rva2VuL2dlbmVyYXRlYDtcblxuICBjb25zdCByZXFPYmogPSB7XG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICdYLUNsaWVudC1JZCc6ICdjb20uYW5pbWFhcHAuZmlnbWEnLFxuICAgICAgJ1gtQ2xpZW50LVZlcnNpb24nOiAnMC4wLjEnLFxuICAgICAgQXV0aG9yaXphdGlvbjogYEpXVCAke2FjY2Vzc190b2tlbn1gXG4gICAgfSxcbiAgICBib2R5XG4gIH07XG4gIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG59XG5cbmNvbnN0IGN1cnJlbnRVc2VyID0gYXN5bmMgKG9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L3VzZXJzL21lYDtcbiAgXG4gICAgY29uc3QgQVVUSF9IRUFERVJTID0ge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9O1xuICBcbiAgICBjb25zdCByZXFPYmogPSB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczogQVVUSF9IRUFERVJTLFxuICAgIH07XG4gIFxuICAgIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgIHJlcU9iai5oZWFkZXJzID0gT2JqZWN0LmFzc2lnbihyZXFPYmouaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICB9XG4gIFxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gIFxuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBqc29uO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnRVJST1IgR0VUVElORyBDVVJSRU5UIFVTRVIgPiAnLCByZXNwb25zZSk7XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChqc29uLmVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck9iaiA9IG5ldyBFcnJvcihqc29uLmRlc2NyaXB0aW9uIHx8ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IGpzb24uc3RhdHVzX2NvZGUgfHwgcmVzcG9uc2Uuc3RhdHVzIHx8IDUwMDtcbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGVycm9yT2JqLmVycm9yID0gJ0Vycm9yJztcbiAgICAgICAgdGhyb3cgZXJyb3JPYmo7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG5jb25zdCBnZXRCcm93c2VyTG9naW5VcmwgPSBhc3luYyAocGFpcmluZ1Rva2VuLCBvcHRpb25zID0ge30sIGRvbnRBZGRTb3VyY2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIXBhaXJpbmdUb2tlbikge1xuICAgICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCBnZW5lcmF0ZVBhaXJpbmdUb2tlbihvcHRpb25zKTtcbiAgICAgICAgICAgIHBhaXJpbmdUb2tlbiA9IHJlc3AudG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgLy9idWlsZCB0aGUgdXJsXG4gICAgICAgIGxldCB1cmwgPSBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9LyR7b3B0aW9ucyAmJiBvcHRpb25zLnRvICYmIG9wdGlvbnMudG89PT0nc2lnbnVwJyA/ICdzaWdudXAnIDogJ2xvZ2luJ30/cGFpcmluZz10cnVlJnB0PSR7cGFpcmluZ1Rva2VufSZwbGF0Zm9ybT0ke29wdGlvbnMucGxhdGZvcm19YFxuXG4gICAgICAgIGlmKG9wdGlvbnMgLyomJiBvcHRpb25zLnRvID09PSAnc2lnbnVwJyovKXsvL2lmIGl0J3Mgc2lnbnVwIGZsb3cgYWRkIG1vcmUgcGFyYW1zXG4gICAgICAgICAgICB1cmwgPSB1cmwgKyAoZG9udEFkZFNvdXJjZSA/IGRvbnRBZGRTb3VyY2UgOiBgJnBsYXRmb3JtPSR7b3B0aW9ucy5wbGF0Zm9ybX0mdXRtX21lZGl1bT1wbHVnaW4mdXRtX3NvdXJjZT1maWdtYSZ1dG1fY29udGVudD1zaWdudXAtYnV0dG9uYClcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByZXNwT2JqID0ge1xuICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgcGFpcmluZ1Rva2VuLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcmVzcE9iajtcbiAgICB9IGNhdGNoIChleGVjKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFVFRJTkcgQlJPV1NFUiBMT0dJTiBVUkwgPiAnLCBleGVjKTtcbiAgICAgICAgdGhyb3cgZXhlYztcbiAgICB9XG59XG5cbmNvbnN0IGdlbmVyYXRlUGFpcmluZ1Rva2VuID0gYXN5bmMgKG9wdGlvbnMgPSB7fSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBzdG9wUG9sbGluZyA9IGZhbHNlO1xuICAgICAgY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9ycGMvZ2VuZXJhdGVfcGFpcmluZ190b2tlbmA7XG5cbiAgICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgaWYgKG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICByZXFPYmouaGVhZGVycyA9IE9iamVjdC5hc3NpZ24ocmVxT2JqLmhlYWRlcnMsIG9wdGlvbnMuaGVhZGVycyk7XG4gICAgICB9XG5cbiAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xuICAgICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICB9XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChqc29uLmVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck9iaiA9IG5ldyBFcnJvcihqc29uLmRlc2NyaXB0aW9uIHx8ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IGpzb24uc3RhdHVzX2NvZGUgfHwgcmVzcG9uc2Uuc3RhdHVzIHx8IDUwMDtcbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGVycm9yT2JqLmVycm9yID0gJ0Vycm9yJztcbiAgICAgICAgdGhyb3cgZXJyb3JPYmo7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXhlYykge1xuICAgICAgY29uc29sZS5sb2coJ0VSUk9SID4gR0VORVJBVElORyBQQUlSSU5HIFRPS0VOID4gJywgZXhlYyk7XG4gICAgICB0aHJvdyBleGVjO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGdldEFjY2Vzc1Rva2VuID0gYXN5bmMgKHBhaXJpbmdUb2tlbiwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghcGFpcmluZ1Rva2VuKSB7XG4gICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUGFpcmluZ1Rva2VuKG9wdGlvbnMpO1xuICAgICAgICAgIHBhaXJpbmdUb2tlbiA9IHJlc3AudG9rZW47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjaGVja1BvbGxpbmdVcmwgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCByZXNwID0gYXdhaXQgcG9sbGluZ1VybChwYWlyaW5nVG9rZW4sIG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKHJlc3AucmVzdWx0ICYmIHJlc3AucmVzdWx0ID09ICdvaycpIHtcbiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSW5zdGFuY2UpO1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGV4ZWMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SID4gR0VUVElORyBBQ0NFU1MgVE9LRU4gPiAnKTtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEluc3RhbmNlKTtcbiAgICAgICAgICAgIHJlamVjdChleGVjKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCFzdG9wUG9sbGluZykge1xuICAgICAgICAgIHRoaXMuaW50ZXJ2YWxJbnN0YW5jZSA9IHNldEludGVydmFsKGNoZWNrUG9sbGluZ1VybCwgMiAqIDEwMDApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChleGVjKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFVFRJTkcgQUNDRVNTIFRPS0VOID4gJywgZXhlYyk7XG4gICAgICAgIHJlamVjdChleGVjKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHBvbGxpbmdVcmwgPSBhc3luYyAocGFpcmluZ1Rva2VuLCBvcHRpb25zID0ge30pID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9ycGMvcGFpcmluZ190b2tlbj90PSR7cGFpcmluZ1Rva2VufWA7XG5cbiAgICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBpZiAob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgICAgIHJlcU9iai5oZWFkZXJzID0gT2JqZWN0LmFzc2lnbihyZXFPYmouaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICAgIH1cblxuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgIH1cbiAgICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGpzb24uZXJyb3IpIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKGpzb24uZGVzY3JpcHRpb24gfHwgJ1NvbWV0aGluZyB3ZW50IHdyb25nIScpO1xuICAgICAgICBlcnJvck9iai5zdGF0dXNDb2RlID0ganNvbi5zdGF0dXNfY29kZSB8fCByZXNwb25zZS5zdGF0dXMgfHwgNTAwO1xuICAgICAgICBpZiAoZXJyb3JPYmouc3RhdHVzQ29kZSA9PSA0MDQpIHtcbiAgICAgICAgICBlcnJvck9iai5tZXNzYWdlID0gJ0ZhaWxlZCB0byBwYWlyLiBQbGVhc2UgdHJ5IGFnYWluISc7XG4gICAgICAgIH1cbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGlmIChlcnJvck9iai5zdGF0dXNDb2RlID09IDQwNCkge1xuICAgICAgICAgIGVycm9yT2JqLm1lc3NhZ2UgPSAnRmFpbGVkIHRvIHBhaXIuIFBsZWFzZSB0cnkgYWdhaW4hJztcbiAgICAgICAgfVxuICAgICAgICBlcnJvck9iai5lcnJvciA9ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4ZWMpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFTkVSQVRJTkcgQVVUSCBVUkwgPiAnLCBleGVjKTtcbiAgICAgIHRocm93IGV4ZWM7XG4gICAgfVxuICB9XG5cblxuY2hyb21lLnRhYnMub25SZW1vdmVkLmFkZExpc3RlbmVyKCh0YWJJZCkgPT4gey8vY2hlY2sgaWYgdGhlIHRhYiBkZWxldGVkXG4gIGNoZWNrSWZUYWJVcGRhdGVkMSh0YWJJZClcbn0pO1xuXG5jaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoKHRhYklkKSA9PiB7Ly9jaGVjayBpZiB0aGUgdGFiIHVwZGF0ZWRcbiAgY2hlY2tJZlRhYlVwZGF0ZWQxKHRhYklkKVxufSk7XG5cbmZ1bmN0aW9uIGNoZWNrSWZUYWJVcGRhdGVkMSh0YWJJZCl7Ly9pZiB0aGUgdGFiIGRlbGV0ZWQgb3IgdXBkYXRlZCBzdG9wIHRoZSBwb2xsaW5nXG4gIGxldCBmaW5kSWZSZWZyZXNoZWQgPSBjaGVja1RhYnNBcmVVcGRhdGVPclJlbW92ZWQuZmluZChmaW5kVGFiPT5maW5kVGFiPT09dGFiSWQpXG4gIGlmKGZpbmRJZlJlZnJlc2hlZCl7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSW5zdGFuY2UpXG4gIH1cbn0gXG4iLCJsZXQgc2VuZEZpcnN0SW5zdGFsbEV2ZW50ID0gZmFsc2VcbmNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcigobWVzc2FnZSwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpID0+IHtcbiAgICBpZihtZXNzYWdlLmFwaSA9PT0gJ3RyYWNrRXZlbnQnKXtcbiAgICAgICAgaWYoc2VuZGVyICYmIHNlbmRlci5vcmlnaW4gJiYgdHlwZW9mIHNlbmRlci5vcmlnaW4gPT09ICdzdHJpbmcnICYmIHNlbmRlci5vcmlnaW4uaW5jbHVkZXMoJy5maWdtYS4nKSl7XG4gICAgICAgICAgbGV0IHBhcmFtcyA9IG1lc3NhZ2UucGFyYW1zID8gbWVzc2FnZS5wYXJhbXMgOiB7fVxuICAgICAgICAgIHNlbmRUcmFja0V2ZW50KG1lc3NhZ2UuZXZlbnROYW1lLCBtZXNzYWdlLnVzZXJJZCwgbWVzc2FnZS51c2VyRW1haWwsIHBhcmFtcylcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmKG1lc3NhZ2UuYXBpID09PSAnZmlyc3RSZWZyZXNoJyl7XG4gICAgICBVVUlEID0gbWVzc2FnZS5VVUlEXG5cbiAgICAgIGlmKHNlbmRGaXJzdEluc3RhbGxFdmVudCl7XG4gICAgICAgIHNlbmRGaXJzdEluc3RhbGxFdmVudCA9IGZhbHNlXG4gICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICBzZW5kVHJhY2tFdmVudCgnY2hyb21lLmV4dGVuc2lvbi5pbnN0YWxsZWQnLCAnJywgJycpXG4gICAgICAgIH0sNTAwMClcbiAgICAgIH1cbiAgICB9ICAgIFxuICAgIGVsc2UgaWYobWVzc2FnZS5hcGkgPT09ICdhbGlhcycpe1xuICAgICAgICBhbGlhcyhtZXNzYWdlLnVzZXJJZCwgbWVzc2FnZS5lbWFpbClcbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbn0pO1xuXG5sZXQgdHJhY2tpbmdDbGFzc1xuZnVuY3Rpb24gc2VuZFRyYWNrRXZlbnQoZXZlbnROYW1lLCB1c2VySWQsIHVzZXJFbWFpbCwgcGFyYW1zID0ge30pe1xuICAgIHVzZXJJZCA9IFVVSUQvL3VzZXJJZCA/IHVzZXJJZCA6IFVVSURcbiAgICBcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgZXZlbnRDYXRlZ29yeTogJ0dlbmVyYWwnLFxuICAgICAgICBldmVudEFjdGlvbjogZXZlbnROYW1lID8gZXZlbnROYW1lIDogJycsXG4gICAgICAgIHVpZDogdXNlcklkLFxuICAgIH07XG4gICAgXG4gICAgcGFyYW1zLmV4dGVuc2lvbk5hbWUgPSB3aW5kb3cuZXh0ZW5zaW9uTmFtZVxuICAgIGFyZ3NbJ3BhcmFtcyddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgICBcbiAgICB2YXIgZGF0YSA9IHBhcmFtZXRpemUoYXJncyk7XG4gICAgdmFyIGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB2YXIgdXJsID0gJ2h0dHBzOi8vbG9ncy5hbmltYWFwcC5jb20vYW5hbHl0aWNzL2NvbGxlY3QnO1xuICAgIGh0dHAub3BlbignUE9TVCcsIHVybCwgdHJ1ZSk7XG5cbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICAvLyBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1JZCcsIHVzZXJJZCA/IHVzZXJJZCA6ICcnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1FbWFpbCcsIHVzZXJFbWFpbCA/IHVzZXJFbWFpbCA6ICcnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtQ2xpZW50LUlkJywgJ2NvbS5hbmltYWFwcC5jaHJvbWUuZXh0ZW5zaW9uJyk7XG4gICAgLy8gaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdYLUNsaWVudC1JZCcsICdjb20uYW5pbWFhcHAuZmlnbWEnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtQ2xpZW50LVZlcnNpb24nLCAnMS4wLjAnKTtcbiAgICBodHRwLnNlbmQoZGF0YSk7XG4gICAgXG4gICAgZnVuY3Rpb24gcGFyYW1ldGl6ZShvYmplY3QpIHtcbiAgICAgIHZhciBlbmNvZGVkU3RyaW5nID0gJyc7XG4gICAgICBmb3IgKHZhciBwcm9wIGluIG9iamVjdCkge1xuICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgaWYgKGVuY29kZWRTdHJpbmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZW5jb2RlZFN0cmluZyArPSAnJic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVuY29kZWRTdHJpbmcgKz0gZW5jb2RlVVJJKHByb3AgKyAnPScgKyBvYmplY3RbcHJvcF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZW5jb2RlZFN0cmluZztcbiAgICB9XG59XG5cblxubGV0IFVVSUQgPSBudWxsXG4vLyBmdW5jdGlvbiBjcmVhdGVVVUlEKCl7XG4vLyAgICAgd2luZG93LmNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KCd1c2VyVVVJRCcsKGRhdGEpPT57XG4vLyAgICAgICAgIGlmKGRhdGEgJiYgZGF0YS51c2VyVVVJRCAmJiBkYXRhLnVzZXJVVUlELmlkKXtcbi8vICAgICAgICAgICAgIFVVSUQgPSBkYXRhLnVzZXJVVUlELmlkXG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZXtcbi8vICAgICAgICAgICAgIFVVSUQgPSBnZW5lcmF0ZU5ld1VVSUQoKVxuLy8gICAgICAgICAgICAgd2luZG93LmNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHt1c2VyVVVJRDp7aWQ6VVVJRH19KVxuLy8gICAgICAgICAgICAgaWYoc2VuZEZpcnN0SW5zdGFsbEV2ZW50KXtcbi8vICAgICAgICAgICAgICAgc2VuZEZpcnN0SW5zdGFsbEV2ZW50ID0gZmFsc2Vcbi8vICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuLy8gICAgICAgICAgICAgICAgIHNlbmRUcmFja0V2ZW50KCdjaHJvbWUuZXh0ZW5zaW9uLmluc3RhbGxlZCcsICcnLCAnJylcbi8vICAgICAgICAgICAgICAgfSw1MDAwKVxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSlcbi8vIH1cblxuY2hyb21lLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24oZGV0YWlscyl7XG4gIGlmKGRldGFpbHMucmVhc29uID09IFwiaW5zdGFsbFwiKXtcbiAgICBzZW5kRmlyc3RJbnN0YWxsRXZlbnQgPSB0cnVlXG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZU5ld1VVSUQoKSB7XG4gICAgdmFyIGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBpZiAoXG4gICAgICB0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgJiZcbiAgICAgIHR5cGVvZiBwZXJmb3JtYW5jZS5ub3cgPT09IFwiZnVuY3Rpb25cIlxuICAgICkge1xuICAgICAgZCArPSBwZXJmb3JtYW5jZS5ub3coKTsgLy91c2UgaGlnaC1wcmVjaXNpb24gdGltZXIgaWYgYXZhaWxhYmxlXG4gICAgfVxuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoXG4gICAgICAvW3h5XS9nLFxuICAgICAgZnVuY3Rpb24oYykge1xuICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDtcbiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTtcbiAgICAgICAgcmV0dXJuIChjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDgpLnRvU3RyaW5nKDE2KTtcbiAgICAgIH1cbiAgICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhbGlhcyh1c2VySWQsIHVzZXJFbWFpbCkge1xuICAgIGlmIChVVUlEICYmIHVzZXJJZCkge1xuICAgICAgY29uc3QgYXJncyA9IHtcbiAgICAgICAgYWxpYXM6IHVzZXJJZCwvL3RoZSB1c2VyIGlkIGZyb20gZGJcbiAgICAgICAgZGlzdGluY3RfaWQ6VVVJRCwgLy90aGUgb2xkIHVzZXIgaWRcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCB1cmwgPSBgaHR0cHM6Ly9sb2dzLmFuaW1hYXBwLmNvbS9hbmFseXRpY3MvcmVnaXN0ZXJfYWxpYXNgO1xuICAgICAgICBsZXQgcmVzID0gYXdhaXQgc2VuZFJlcXVlc3QodXJsLCBhcmdzLCB1c2VySWQsIHVzZXJFbWFpbCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3Rlcl9hbGlhcyBmYWlsZWQnLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZW5kUmVxdWVzdCh1cmwsIGFyZ3MsIHVzZXJJZCwgdXNlckVtYWlsKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZWplY3QsIHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBwYXJhbWV0ZXJpemUoYXJncyk7XG5cbiAgICAgIGNvbnN0IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIFxuICAgICAgaHR0cC5vcGVuKCdQT1NUJywgdXJsLCB0cnVlKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdYLVVzZXItSWQnLCB1c2VySWQgPyB1c2VySWQgOiAnJyk7XG4gICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1FbWFpbCcsIHVzZXJFbWFpbCA/IHVzZXJFbWFpbCA6ICcnKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignWC1DbGllbnQtSWQnLCAnY29tLmFuaW1hYXBwLmNocm9tZS5leHRlbnNpb24nKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignWC1DbGllbnQtVmVyc2lvbicsICcxLjAuMCcpO1xuXG5cbiAgICAgIGZvciAoY29uc3QgaCBpbiB0aGlzLmhlYWRlcnMpIHtcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuaGVhZGVyc1toXTtcbiAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKGgsIHYpO1xuICAgICAgfVxuXG4gICAgICBodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGh0dHAucmVhZHlTdGF0ZSA9PT0gNCAmJiBodHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgcmVzb2x2ZShodHRwLnJlc3BvbnNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgc3RhdHVzOiBodHRwLnN0YXR1cyxcbiAgICAgICAgICAgIHN0YXR1c1RleHQ6IGh0dHAuc3RhdHVzVGV4dCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaHR0cC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3Qoe1xuICAgICAgICAgIHN0YXR1czogaHR0cC5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogaHR0cC5zdGF0dXNUZXh0LFxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGh0dHAuc2VuZChkYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHBhcmFtZXRlcml6ZSA9IChvYmopID0+IHtcbiAgICBsZXQgZW5jb2RlZFN0cmluZyA9ICcnO1xuICAgIGZvciAobGV0IHByb3AgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgIGlmIChlbmNvZGVkU3RyaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBlbmNvZGVkU3RyaW5nICs9ICcmJztcbiAgICAgICAgfVxuICAgICAgICBlbmNvZGVkU3RyaW5nICs9IGVuY29kZVVSSShwcm9wICsgJz0nICsgb2JqW3Byb3BdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVuY29kZWRTdHJpbmc7XG4gIH07Il0sInNvdXJjZVJvb3QiOiIifQ==